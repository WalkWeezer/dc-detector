# üî• DC-Detector 2.0

–°–∏—Å—Ç–µ–º–∞ –¥–µ—Ç–µ–∫—Ü–∏–∏ –æ–≥–Ω—è —Å –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π:

- `frontend` ‚Äî –ª–µ–≥–∫–∏–π HTML/JS –∫–ª–∏–µ–Ω—Ç (–ª–æ–∫–∞–ª—å–Ω–∞—è –∫–∞–º–µ—Ä–∞, –æ—Ç—Ä–∏—Å–æ–≤–∫–∞ bbox, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–ª–∏–ø‚ÄëGIF–æ–≤), –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —á–µ—Ä–µ–∑ nginx –∏–ª–∏ Vite dev‚Äë—Å–µ—Ä–≤–µ—Ä.
- `backend` ‚Äî Node.js REST API: –ø—Ä–æ–∫—Å–∏ –∫ detection-—Å–µ—Ä–≤–∏—Å—É –∏ —Ñ–∞–π–ª–æ–≤–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–µ—Ç–µ–∫—Ü–∏–π.
- `detection` ‚Äî Python/YOLO –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å: –∑–∞—Ö–≤–∞—Ç –≤–∏–¥–µ–æ–ø–æ—Ç–æ–∫–∞, –∏–Ω—Ñ–µ—Ä–µ–Ω—Å, —Ç—Ä–µ–∫–∏–Ω–≥ –æ–±—ä–µ–∫—Ç–æ–≤. **–ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ –æ—Ç Docker** –¥–ª—è –ª—É—á—à–µ–π —Ä–∞–±–æ—Ç—ã —Å –∫–∞–º–µ—Ä–æ–π.

–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ ‚Äî Windows/amd64, –¥–µ–ø–ª–æ–π ‚Äî Raspberry Pi (Debian 64‚Äëbit, arm64).

## üì¶ –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```
.
‚îú‚îÄ‚îÄ docker/
‚îÇ   ‚îú‚îÄ‚îÄ backend.Dockerfile
‚îÇ   ‚îî‚îÄ‚îÄ frontend.Dockerfile
‚îú‚îÄ‚îÄ docker-compose.yml            # –±–∞–∑–æ–≤—ã–π compose (backend + frontend)
‚îú‚îÄ‚îÄ docker-compose.dev.yml        # Windows dev (Vite hot-reload)
‚îú‚îÄ‚îÄ docker-compose.pi.yml         # Raspberry Pi (–ø—Ä–æ–¥-—Å–±–æ—Ä–∫–∞ —Ñ—Ä–æ–Ω—Ç–∞)
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ backend/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ package.json
‚îÇ   ‚îî‚îÄ‚îÄ detection/
‚îÇ       ‚îú‚îÄ‚îÄ detection_server.py   # –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ –æ—Ç Docker
‚îÇ       ‚îú‚îÄ‚îÄ models/
‚îÇ       ‚îî‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ frontend/
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îî‚îÄ‚îÄ detections/               # JSON-—Ñ–∞–π–ª—ã —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ –¥–µ—Ç–µ–∫—Ü–∏–∏ (–ø–æ –¥–∞—Ç–∞–º)
‚îú‚îÄ‚îÄ systemd/
‚îÇ   ‚îú‚îÄ‚îÄ dc-detection.service      # systemd service –¥–ª—è Detection Service
‚îÇ   ‚îî‚îÄ‚îÄ dc-detector.service       # systemd service –¥–ª—è Backend/Frontend
```

## ‚öôÔ∏è –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **Detection Service**: Python 3.11+ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ)
- **Backend/Frontend**: Docker 24+, Docker Compose v2 (Windows: Desktop) –∏–ª–∏ Node.js 20 –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞
- **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Detection Service**: 
  - `ultralytics` (YOLO)
  - `opencv-python` 
  - `numpy`
  - –°–º. `services/detection/requirements.txt`

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (dev, Windows/macOS/Linux)

### –®–∞–≥ 1: –ó–∞–ø—É—Å–∫ Detection Service (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, –æ—Ç–¥–µ–ª—å–Ω–æ –æ—Ç Docker)

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
   ```bash
   cd services/detection
   pip install -r requirements.txt
   ```

2. –ü–æ–º–µ—Å—Ç–∏—Ç–µ –º–æ–¥–µ–ª—å YOLO –≤ `services/detection/models/`:
   - `yolov8n.pt` (–±–∞–∑–æ–≤–∞—è –º–æ–¥–µ–ª—å)
   - `bestfire.pt` (—Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –º–æ–¥–µ–ª—å)

3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ detection service:
   ```bash
   cd services/detection
   python detection_server.py
   ```
   
   –ò–ª–∏ –Ω–∞ Windows:
   ```powershell
   cd services\detection
   python detection_server.py
   ```

4. –°–µ—Ä–≤–∏—Å –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ `http://localhost:8001`
   - Health check: `http://localhost:8001/health`
   - –°—Ç–∞—Ç—É—Å –¥–µ—Ç–µ–∫—Ü–∏–∏: `http://localhost:8001/api/detection`
   - –°–ø–∏—Å–æ–∫ —Ç—Ä–µ–∫–µ—Ä–æ–≤: `http://localhost:8001/api/trackers`
   - –í–∏–¥–µ–æ –ø–æ—Ç–æ–∫: `http://localhost:8001/video_feed_raw`

### –®–∞–≥ 2: –ó–∞–ø—É—Å–∫ Backend –∏ Frontend

1. (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ `env.example` –≤ `.env` –∏ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `DETECTION_URL=http://localhost:8001`

2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ backend –∏ frontend:
   ```bash
   docker compose up --build
   ```

3. –î–æ—Å—Ç—É–ø—ã:
   - Frontend: <http://localhost>
   - Backend API: <http://localhost:8080>
   - Detection Service: <http://localhost:8001>

## üåê –î–æ—Å—Ç—É–ø –ø–æ —Å–µ—Ç–∏ (Ethernet)

–î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥—É —Å –¥—Ä—É–≥–∏—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏:

### Dev —Ä–µ–∂–∏–º (Vite):
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ `vite.config.js` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ `host: '0.0.0.0'` (—É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ)
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ dev-—Å–µ—Ä–≤–µ—Ä:
   ```bash
   docker compose -f docker-compose.yml -f docker-compose.dev.yml up
   ```
3. –ù–∞–π–¥–∏—Ç–µ IP-–∞–¥—Ä–µ—Å –≤–∞—à–µ–≥–æ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞:
   - Windows: `ipconfig` (—Å–º–æ—Ç—Ä–∏—Ç–µ IPv4 –∞–¥—Ä–µ—Å Ethernet –∞–¥–∞–ø—Ç–µ—Ä–∞)
   - Linux/macOS: `ip addr` –∏–ª–∏ `ifconfig`
4. –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ –Ω–∞ –¥—Ä—É–≥–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ:
   - Frontend: `http://<–≤–∞—à-IP>:5173` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `http://192.168.1.100:5173`)
   - Backend API: `http://<–≤–∞—à-IP>:8080`

### Production —Ä–µ–∂–∏–º (Nginx):
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ—Ä—Ç—ã 80 –∏ 443 –æ—Ç–∫—Ä—ã—Ç—ã –≤ firewall
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ production —Å—Ç–µ–∫:
   ```bash
   docker compose up --build
   ```
3. –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ –Ω–∞ –¥—Ä—É–≥–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ:
   - Frontend: `http://<–≤–∞—à-IP>` –∏–ª–∏ `https://<–≤–∞—à-IP>`
   - Backend API: `http://<–≤–∞—à-IP>:8080`

### –í–∞–∂–Ω–æ:
- **Firewall**: –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Windows Firewall –∏–ª–∏ –¥—Ä—É–≥–æ–π firewall —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –≤—Ö–æ–¥—è—â–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –Ω–∞ –ø–æ—Ä—Ç—ã 5173 (dev) –∏–ª–∏ 80/443 (production) –∏ 8080 (backend)
- **HTTPS –¥–ª—è getUserMedia**: –î–ª—è —Ä–∞–±–æ—Ç—ã –≤–µ–±-–∫–∞–º–µ—Ä—ã –≤ –±—Ä–∞—É–∑–µ—Ä–µ –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è HTTPS. –í production —Ä–µ–∂–∏–º–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–∞–º–æ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç (–±—É–¥–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ)
- **CORS**: Backend –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç origin –∏ —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã —Å –ª—é–±–æ–≥–æ —Ö–æ—Å—Ç–∞ –≤ dev —Ä–µ–∂–∏–º–µ

–ü—Ä–∏–º–µ—Ä `.env` (–∏–ª–∏ —Å–º. `env.example`):
```dotenv
PORT=8080
DETECTION_URL=http://localhost:8001  # URL detection service (–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ)
DETECTIONS_DIR=data/detections
JWT_SECRET=change-me
```

**–í–∞–∂–Ω–æ:** `DETECTION_URL` –¥–æ–ª–∂–µ–Ω —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ –∞–¥—Ä–µ—Å, –≥–¥–µ –∑–∞–ø—É—â–µ–Ω detection service. –ï—Å–ª–∏ –æ–Ω –∑–∞–ø—É—â–µ–Ω –Ω–∞ —Ç–æ–º –∂–µ —Ö–æ—Å—Ç–µ - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `http://localhost:8001`. –ï—Å–ª–∏ –Ω–∞ –¥—Ä—É–≥–æ–º —Ö–æ—Å—Ç–µ - —É–∫–∞–∂–∏—Ç–µ –µ–≥–æ IP –∞–¥—Ä–µ—Å.

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –§–∞–π–ª `.env` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è –∏–∑ `env.example` –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ —á–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç `scripts/init.sh`.

## üêç Detection Service

**–í–∞–∂–Ω–æ:** Detection service –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è **–æ—Ç–¥–µ–ª—å–Ω–æ –æ—Ç Docker** –¥–ª—è –ª—É—á—à–µ–π —Ä–∞–±–æ—Ç—ã —Å –∫–∞–º–µ—Ä–æ–π –∏ –¥–æ—Å—Ç—É–ø–∞ –∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º.

### –ó–∞–ø—É—Å–∫ Detection Service

**Windows/Linux/macOS:**
```bash
cd services/detection
python detection_server.py
```

**–° —É–∫–∞–∑–∞–Ω–∏–µ–º –ø–æ—Ä—Ç–∞:**
```bash
PORT=8080 python detection_server.py
```

**–° —É–∫–∞–∑–∞–Ω–∏–µ–º –∏–Ω–¥–µ–∫—Å–∞ –∫–∞–º–µ—Ä—ã:**
```bash
CAMERA_INDEX=0 python detection_server.py
```

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫–∞–Ω–∏—Ä—É–µ—Ç –ª–æ–∫–∞–ª—å–Ω—ã–µ –≤–µ–±-–∫–∞–º–µ—Ä—ã (–∏–Ω–¥–µ–∫—Å—ã `0..4`) –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø–æ—Ç–æ–∫ —Å –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç Picamera2 (–Ω–∞—Ç–∏–≤–Ω—ã–π API –¥–ª—è Raspberry Pi) –∏ –≤–µ–±-–∫–∞–º–µ—Ä—ã —á–µ—Ä–µ–∑ OpenCV
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã–µ –º–æ–¥–µ–ª–∏ YOLO –∏–∑ `services/detection/models/`
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π —á–µ—Ä–µ–∑ API (`POST /models`)

### –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã

#### –í–∏–¥–µ–æ–ø–æ—Ç–æ–∫–∏
- `GET /video_feed_raw` ‚Äî —Å—ã—Ä–æ–π MJPEG –ø–æ—Ç–æ–∫ –±–µ–∑ –¥–µ—Ç–µ–∫—Ü–∏–π (–º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å).
- `GET /video_feed` ‚Äî MJPEG –ø–æ—Ç–æ–∫ —Å –Ω–∞–ª–æ–∂–µ–Ω–Ω—ã–º–∏ –¥–µ—Ç–µ–∫—Ü–∏—è–º–∏ (bbox –∏ –º–µ—Ç–∫–∏).

#### –¢—Ä–µ–∫–µ—Ä—ã
- `GET /api/trackers` ‚Äî —Å–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ç—Ä–µ–∫–µ—Ä–æ–≤ —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏ (trackId, bbox, confidence, label).
- `GET /api/trackers/<track_id>/crop` ‚Äî –∫—Ä–æ–ø–Ω—É—Ç—ã–π –∫–∞–¥—Ä –¥–ª—è —Ç—Ä–µ–∫–µ—Ä–∞ (JPEG, –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è GIF).
- `GET /api/trackers/<track_id>/frames` ‚Äî –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∫—Ä–æ–ø–Ω—É—Ç—ã—Ö –∫–∞–¥—Ä–æ–≤ –¥–ª—è —Ç—Ä–µ–∫–µ—Ä–∞ (JSON —Å base64 –∫–∞–¥—Ä–∞–º–∏, –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è GIF).

#### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª—è–º–∏
- `GET /models` ‚Äî —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π –∏ –∞–∫—Ç–∏–≤–Ω–∞—è –º–æ–¥–µ–ª—å.
- `POST /models` ‚Äî –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ (—Ç–µ–ª–æ: `{ "name": "model_name.pt" }`).

#### –°–∏—Å—Ç–µ–º–∞
- `GET /health` ‚Äî health check (—Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–∞, –∞–∫—Ç–∏–≤–Ω–∞—è –∫–∞–º–µ—Ä–∞, –º–æ–¥–µ–ª—å)
- `GET /api/detection` ‚Äî –¥–µ—Ç–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å –¥–µ—Ç–µ–∫—Ü–∏–∏ (–º–æ–¥–µ–ª—å, —Ç—Ä–µ–∫–µ—Ä, –ø–æ—Ç–æ–∫)

## üü© Backend (Node.js)

- REST:
  - `GET /api/detections`
  - `GET /api/detections/status`
  - `GET /api/detections/stream` ‚Äî –ø—Ä–æ–∫—Å–∏ MJPEG-–ø–æ—Ç–æ–∫–∞ —Å detection-—Å–µ—Ä–≤–∏—Å–∞
  - `POST /api/detections/run` ‚Äî –ø—Ä–æ–∫—Å–∏ –∫ `detection`.
- `GET /api/detections/models`, `POST /api/detections/models` ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª—å—é –¥–µ—Ç–µ–∫—Ü–∏–∏.
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º:
  - `POST /api/detections/save` ‚Äî —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–µ–∫—É—â—É—é –¥–µ—Ç–µ–∫—Ü–∏—é –∏ –∫–æ—Ä–æ—Ç–∫–∏–π GIF (—Ç–µ–ª–æ: `{ detection, frames:[dataUrl...], fps }`).
  - `GET /api/detections/saved?date=YYYY-MM-DD` ‚Äî —Å–ø–∏—Å–æ–∫ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –∑–∞ –¥–µ–Ω—å.
  - –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã –ø–æ `/files/...` (–æ—Ç –∫–æ—Ä–Ω—è `data/`), –Ω–∞–ø—Ä–∏–º–µ—Ä: `/files/detections/saved/2025-11-03/<id>.gif`.
- –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç—ã (–Ω–µ –ø—É–±–ª–∏–∫—É—é—Ç—Å—è –Ω–∞—Ä—É–∂—É):
  - `POST /internal/detections`
- –•—Ä–∞–Ω–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ JSON-—Ñ–∞–π–ª–∞—Ö (`data/detections/YYYY-MM-DD.json`).

## üóÉÔ∏è –•—Ä–∞–Ω–∏–ª–∏—â–µ –¥–µ—Ç–µ–∫—Ü–∏–π

- Backend –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë—Ç –∫–∞—Ç–∞–ª–æ–≥ `data/detections` –∏ –≤–µ–¥—ë—Ç —Ñ–∞–π–ª—ã –ø–æ –¥–∞—Ç–∞–º (`YYYY-MM-DD.json`).
- –ö–∞–∂–¥—ã–π –æ–±—ä–µ–∫—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π `id`, `trackId`, –º–µ—Ç–∫–∏ `firstSeen/lastSeen`, bbox –∏ –∞–∫—Ç—É–∞–ª—å–Ω—É—é —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å.
- –î–µ—Ç–µ–∫—Ü–∏–∏ —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º `trackId` –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è (–Ω–µ –¥—É–±–ª–∏—Ä—É—é—Ç—Å—è).

### –°–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º (JSON + GIF)
- –ü—É—Ç—å: `data/detections/saved/YYYY-MM-DD/<id>.{json,gif}`
- JSON —Å–æ–¥–µ—Ä–∂–∏—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –¥–µ—Ç–µ–∫—Ü–∏–∏ –∏ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ –ø—É—Ç–∏ –¥–æ GIF/JSON, GIF ‚Äî –∫–ª–∏–ø –∏–∑ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∫–∞–¥—Ä–æ–≤ (–æ–±—ã—á–Ω–æ 2‚Äì3 —Å–µ–∫, —à–∏—Ä–∏–Ω–∞ 320px).
- –î–æ—Å—Ç—É–ø –∫ —Ñ–∞–π–ª–∞–º: `/files/detections/saved/YYYY-MM-DD/<id>.gif`.

## üèÅ Raspberry Pi / –ø—Ä–æ–¥ —Ä–µ–∂–∏–º

> üìñ **–ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∑–∞–ø—É—Å–∫—É detection service:** —Å–º. [RASPBERRY_PI_SETUP.md](RASPBERRY_PI_SETUP.md)

### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è

1. –°–∫–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–∞ Raspberry Pi:
   ```bash
   git clone <repository-url>
   cd DC-Detector
   ```

2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö —Ñ–∞–π–ª–æ–≤ –∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π:
   ```bash
   ./scripts/init.sh
   ```
   –°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—Å—Ç `.env` –∏–∑ `env.example` (–µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç) –∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏.

3. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–ª—è Detection Service:**
   ```bash
   cd services/detection
   python3 -m venv venv
   source venv/bin/activate
   pip install -r requirements.txt
   ```

4. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ Detection Service:**
   ```bash
   cd services/detection
   source venv/bin/activate  # –µ—Å–ª–∏ –µ—â–µ –Ω–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–æ
   python3 detection_server.py
   ```
   
   –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≥–æ—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç:
   ```bash
   ./scripts/run-detection-direct.sh
   ```

5. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ Backend –∏ Frontend (–≤ Docker):**
   ```bash
   # –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ .env —É–∫–∞–∑–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π DETECTION_URL
   # DETECTION_URL=http://localhost:8001
   
   docker compose -f docker-compose.yml -f docker-compose.pi.yml up -d --build
   ```

### –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–∏—Å—Ç–µ–º—ã

–î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ Raspberry Pi:

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ systemd services:
   ```bash
   sudo ./scripts/install-systemd.sh
   ```

2. (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –£–∫–∞–∂–∏—Ç–µ –ø—É—Ç—å –∫ –ø—Ä–æ–µ–∫—Ç—É, –µ—Å–ª–∏ –æ–Ω –Ω–µ –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏:
   ```bash
   export DC_DETECTOR_PATH=/path/to/DC-Detector
   sudo -E ./scripts/install-systemd.sh
   ```

3. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞–º–∏:
   ```bash
   # Detection Service (–æ—Ç–¥–µ–ª—å–Ω—ã–π —Å–µ—Ä–≤–∏—Å)
   sudo systemctl start dc-detection
   sudo systemctl stop dc-detection
   sudo systemctl status dc-detection
   sudo journalctl -u dc-detection -f
   
   # Backend –∏ Frontend (Docker Compose)
   sudo systemctl start dc-detector
   sudo systemctl stop dc-detector
   sudo systemctl status dc-detector
   sudo journalctl -u dc-detector -f
   ```

### –í–∏–¥–µ–æ–ø–æ—Ç–æ–∫

–í —Ä–µ–∂–∏–º–µ Raspberry Pi —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –º–æ–∂–µ—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –¥–≤–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞:
- –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ `/` ‚Äî –ª–æ–∫–∞–ª—å–Ω–∞—è –∫–∞–º–µ—Ä–∞ –∫–ª–∏–µ–Ω—Ç–∞ (—É–¥–æ–±–Ω–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
- –°—Ç—Ä–∞–Ω–∏—Ü–∞ `/pi.html` ‚Äî –ø–æ—Ç–æ–∫ —Å –∫–∞–º–µ—Ä—ã Raspberry Pi (—Å–µ—Ä–≤–µ—Ä–Ω—ã–π MJPEG)

–ü–æ—Ç–æ–∫–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ API:
- `GET /api/detections/stream` ‚Äî MJPEG c —Å–µ—Ä–≤–µ—Ä–Ω–æ–π —Ä–∞–∑–º–µ—Ç–∫–æ–π (bbox —Ä–∏—Å—É–µ—Ç detection)
- `GET /api/detections/stream-raw` ‚Äî ¬´—á–∏—Å—Ç—ã–π¬ª MJPEG –±–µ–∑ —Ä–∞–∑–º–µ—Ç–∫–∏ (bbox —Ä–∏—Å—É–µ—Ç —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥)

–î–æ—Å—Ç—É–ø –∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É:
- –ü–æ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏: `http://<IP-raspberry-pi>/` –∏–ª–∏ `https://<IP-raspberry-pi>/`
- –ù–∞ —Å–∞–º–æ–º Raspberry Pi: `http://localhost/` –∏–ª–∏ `https://localhost/`

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –∑–∞–ø—É—Å—Ç–∏—Ç–µ –∞–≤—Ç–æ—Ç–µ—Å—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:

```bash
./scripts/test-deployment.sh
```

–°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç:
- –í—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã backend –∏ detection —Å–µ—Ä–≤–∏—Å–æ–≤
- –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
- –†–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å Pi Camera
- –í–∏–¥–µ–æ–ø–æ—Ç–æ–∫

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ç–µ—Å—Ç–æ–≤ –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
```bash
BACKEND_URL=http://localhost:8080 \
DETECTION_URL=http://localhost:8001 \
FRONTEND_URL=http://localhost \
./scripts/test-deployment.sh
```

`docker-compose.pi.yml` –≤–∫–ª—é—á–∞–µ—Ç —Å–±–æ—Ä–∫—É —Ñ—Ä–æ–Ω—Ç–∞. Detection Service –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ –∏ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç Docker.

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è FPS –Ω–∞ Raspberry Pi

1. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –¥—Ä–∞–π–≤–µ—Ä/—Ñ–æ—Ä–º–∞—Ç –∫–∞–º–µ—Ä—ã (–Ω–∞ —Ö–æ—Å—Ç–µ):
   ```bash
   sudo modprobe bcm2835-v4l2
   v4l2-ctl -d /dev/video0 --set-fmt-video=width=640,height=480,pixelformat=MJPG
   v4l2-ctl -d /dev/video0 --set-parm=15
   ```

2. –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è Detection Service:
   ```bash
   export CAMERA_INDEX=0
   export CONFIDENCE_THRESHOLD=0.5
   export INFER_FPS=5  # FPS –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–∞ YOLO
   export PORT=8001
   ```

3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:
   ```bash
   CAMERA_INDEX=0 INFER_FPS=5 python3 detection_server.py
   ```

## üîß –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

**Detection Service:**
- –ó–∞–ø—É—Å–∫: `cd services/detection && python detection_server.py`
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞: `curl http://localhost:8001/api/detection`
- –õ–æ–≥–∏: —Å–º–æ—Ç—Ä–∏—Ç–µ –≤—ã–≤–æ–¥ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –∏–ª–∏ systemd –∂—É—Ä–Ω–∞–ª

**Backend/Frontend (Docker):**
- –õ–æ–≥–∏: `docker compose logs -f backend frontend`
- –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –¥–µ—Ç–µ–∫—Ü–∏–π: `ls data/detections`
- –û—á–∏—Å—Ç–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–µ—Ç–µ–∫—Ü–∏–π: —É–¥–∞–ª–∏—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π `data/detections/YYYY-MM-DD.json`

## üßë‚Äçüíª –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Å hot-reload

–î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `docker-compose.dev.yml` (Vite HMR) –ø–æ–≤–µ—Ä—Ö –±–∞–∑–æ–≤–æ–≥–æ —Ñ–∞–π–ª–∞:

- **Detection Service**: –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ, –ø—Ä–∞–≤–∫–∏ –≤ `detection_server.py` –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞
- **Backend (Node 20)**: –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–∞–∫ `node --watch src/server.js`, –∫–∞—Ç–∞–ª–æ–≥ `services/backend/src` –ø—Ä–∏–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω –≤–Ω—É—Ç—Ä—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞. –õ—é–±—ã–µ –ø—Ä–∞–≤–∫–∏ `.js` –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è —Å—Ä–∞–∑—É.
- **Frontend**: –∫–∞—Ç–∞–ª–æ–≥ `frontend/` –ø—Ä–∏–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω –≤ `/usr/share/nginx/html` ‚Äî –ø—Ä–∞–≤–∫–∏ HTML/CSS/JS –≤–∏–¥–Ω—ã –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –Ω–∞ `http://localhost`.

–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π Vite HMR

```bash
docker compose -f docker-compose.yml -f docker-compose.dev.yml up -d   # frontend-dev –Ω–∞ http://localhost:5173
```

–§—Ä–æ–Ω—Ç–µ–Ω–¥ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏
- –ö–Ω–æ–ø–∫–∞ ¬´–°–æ—Ö—Ä–∞–Ω–∏—Ç—å¬ª –≤ —Å–ø–∏—Å–∫–µ –¥–µ—Ç–µ–∫—Ü–∏–π –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–µ –±—É—Ñ–µ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∫–∞–¥—Ä—ã –Ω–∞ `POST /api/detections/save`.
- –í–∫–ª–∞–¥–∫–∞ ¬´–°–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ¬ª –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –º–∏–Ω–∏–∞—Ç—é—Ä—ã GIF –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç –±—ã—Å—Ç—Ä–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –∫–ª–∏–ø—ã. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ ‚Äî –∫–Ω–æ–ø–∫–∞ ¬´–û–±–Ω–æ–≤–∏—Ç—å¬ª, —Ñ–∏–ª—å—Ç—Ä –ø–æ –¥–∞—Ç–µ.

–ë–∞–∑–æ–≤—ã–π dev –±–µ–∑ Vite (nginx —Å—Ç–∞—Ç–∏–∫–∞) ‚Äî –ø—Ä–æ—Å—Ç–æ:

```bash
docker compose up -d
```

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT

# üî• Detection Service

–°–µ—Ä–≤–∏—Å –¥–µ—Ç–µ–∫—Ü–∏–∏ –æ–≥–Ω—è –Ω–∞ –±–∞–∑–µ YOLO –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –≤–∏–¥–µ–æ–ø–æ—Ç–æ–∫–∞ –æ—Ç camera-service.

## ‚ö†Ô∏è –í–∞–∂–Ω–æ –¥–ª—è Raspberry Pi

–ù–∞ Raspberry Pi —Ç—Ä–µ–±—É–µ—Ç—Å—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ PyTorch —á–µ—Ä–µ–∑ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π —Å–∞–π—Ç:
```bash
# –î–ª—è ARM64 (Raspberry Pi 4+, OS 64-bit)
pip3 install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cpu

# –î–ª—è ARM32 (Raspberry Pi 4, OS 32-bit)
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–∫—É –∏–∑ –æ–±—Ä–∞–∑–∞ –∏–ª–∏ —Å–∫–æ–º–ø–∏–ª–∏—Ä—É–π—Ç–µ –∏–∑ –∏—Å—Ö–æ–¥–Ω–∏–∫–æ–≤
```

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üîç –î–µ—Ç–µ–∫—Ü–∏—è –æ–≥–Ω—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- üé• –ê–Ω–∞–ª–∏–∑ –≤–∏–¥–µ–æ–ø–æ—Ç–æ–∫–∞ –æ—Ç camera-service
- üìä REST API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- üé® –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –¥–µ—Ç–µ–∫—Ü–∏–π –Ω–∞ –∫–∞–¥—Ä–∞—Ö
- ‚ö†Ô∏è –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏

## –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

1. –ó–∞–ø—É—â–µ–Ω–Ω—ã–π camera-service –Ω–∞ –ø–æ—Ä—Ç—É 8000
2. –ú–æ–¥–µ–ª—å YOLO –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ (`bestfire.pt`)

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

#### –ù–∞ –æ–±—ã—á–Ω–æ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ

```bash
cd detection-service
pip3 install -r requirements.txt
python3 detection_server.py
```

#### –ù–∞ Raspberry Pi (—Å –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–º PyTorch)

```bash
cd detection-service
pip3 install flask opencv-python numpy requests
python3 detection_server.py
```

–°–µ—Ä–≤–∏—Å –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É: http://localhost:8001

## API Endpoints

- `GET /` - –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ –¥–µ—Ç–µ–∫—Ü–∏–∏
- `GET /api/detection` - JSON —Å—Ç–∞—Ç—É—Å –¥–µ—Ç–µ–∫—Ü–∏–∏
- `GET /detection_frame` - –ü–æ—Å–ª–µ–¥–Ω–∏–π –∫–∞–¥—Ä —Å –¥–µ—Ç–µ–∫—Ü–∏—è–º–∏ (MJPEG)
- `GET /health` - Health check

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞

```bash
curl http://localhost:8001/api/detection
```

–û—Ç–≤–µ—Ç:
```json
{
  "detected": true,
  "count": 2,
  "confidence": 0.87,
  "last_detection": 1698405000.0,
  "detections": [
    {
      "bbox": [100.0, 150.0, 250.0, 300.0],
      "confidence": 0.87,
      "class_id": 0
    }
  ]
}
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–∞–¥—Ä–∞ —Å –¥–µ—Ç–µ–∫—Ü–∏—è–º–∏

```bash
curl http://localhost:8001/detection_frame -o detection.jpg
```

## –ù–∞—Å—Ç—Ä–æ–π–∫–∏

–í `detection_server.py` –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å:

- `CAMERA_SERVICE_URL` - URL —Å–µ—Ä–≤–∏—Å–∞ –∫–∞–º–µ—Ä—ã
- `MODEL_PATH` - –ü—É—Ç—å –∫ –º–æ–¥–µ–ª–∏ YOLO
- `CONFIDENCE_THRESHOLD` - –ü–æ—Ä–æ–≥ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –¥–µ—Ç–µ–∫—Ü–∏–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 0.5)

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
camera-service (8000) ‚Üí detection-service (8001)
     ‚Üì                         ‚Üì
  Video Feed              YOLO Model
                           Detection
                             ‚Üì
                      Detection Results
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –¥—Ä—É–≥–∏—Ö —Å–µ—Ä–≤–∏—Å–∞—Ö

–°–µ—Ä–≤–∏—Å –¥–µ—Ç–µ–∫—Ü–∏–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –¥—Ä—É–≥–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö —Å–∏—Å—Ç–µ–º—ã:

```python
import requests

response = requests.get('http://localhost:8001/api/detection')
data = response.json()

if data['detected']:
    print(f"üî• –û–±–Ω–∞—Ä—É–∂–µ–Ω –æ–≥–æ–Ω—å! {data['count']} –æ–±—ä–µ–∫—Ç–æ–≤")
    # –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ, —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤–∏–¥–µ–æ –∏ —Ç.–¥.
```

## –û—Å—Ç–∞–Ω–æ–≤–∫–∞

–ù–∞–∂–º–∏—Ç–µ `Ctrl+C` –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ, –≥–¥–µ –∑–∞–ø—É—â–µ–Ω —Å–µ—Ä–≤–∏—Å.


services:
  backend:
    build:
      context: .
      dockerfile: docker/backend.Dockerfile
    environment:
      - PORT=8080
      - DETECTION_URL=http://detection:8001
    depends_on:
      detection:
        condition: service_started
    ports:
      - "8080:8080"
    volumes:
      - ./data:/app/data
    networks: [app]

  detection:
    build:
      context: .
      dockerfile: docker/detection.Dockerfile
    environment:
      - CAMERA_INDEX=0
      - CAMERA_SCAN_LIMIT=5
      - MODEL_PATH=models/yolov8n.pt
      - BACKEND_NOTIFY_URL=http://backend:8080/internal/detections
    dns:
      - 8.8.8.8
      - 1.1.1.1
    volumes:
      - ./services/detection/models:/app/models
    networks: [app]

  frontend:
    build:
      context: .
      dockerfile: docker/frontend.Dockerfile
    depends_on:
      - backend
    ports:
      - "80:80"
    networks: [app]

networks:
  app: {}

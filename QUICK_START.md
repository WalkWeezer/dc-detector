# üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (–¥–≤–∞ —Å—Ü–µ–Ω–∞—Ä–∏—è)

–í –ø—Ä–æ–µ–∫—Ç–µ –¥–≤–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞ –∑–∞–ø—É—Å–∫–∞:
- Windows dev ‚Äî Vite hot‚Äëreload, —É–¥–æ–±–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
- Raspberry Pi ‚Äî —Å–æ–±—Ä–∞–Ω–Ω—ã–π —Ñ—Ä–æ–Ω—Ç –ø–æ–¥ nginx, —Ä–∞–±–æ—á–∏–π —Ä–µ–∂–∏–º

## 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Docker Desktop (Windows/macOS) –∏–ª–∏ Docker Engine + Compose v2 (Linux).
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è `.env` –∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π:
   ```bash
   ./scripts/init.sh
   ```
   –ò–ª–∏ –≤—Ä—É—á–Ω—É—é —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ `env.example` –≤ `.env` –∏ –∏–∑–º–µ–Ω–∏—Ç–µ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.
3. –ü–æ–º–µ—Å—Ç–∏—Ç–µ –º–æ–¥–µ–ª—å YOLO –≤ `services/detection/models/bestfire.pt`.

## 2. Windows dev (–≥–æ—Ä—è—á–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞)

–ö–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞:
```bash
docker compose -f docker-compose.yml -f docker-compose.dev.yml up --build
```

–°–µ—Ä–≤–∏—Å—ã:
- —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ (Vite): http://localhost:5173
- backend (Node): http://localhost:8080
- detection (Python): health http://localhost:8001/health

–û—Å—Ç–∞–Ω–æ–≤–∫–∞:
```bash
docker compose down
```

## 3. Raspberry Pi (—Ä–∞–±–æ—á–∏–π —Ä–µ–∂–∏–º)

### –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:
   ```bash
   ./scripts/init.sh
   ```

2. (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –ù–∞—Å—Ç—Ä–æ–π—Ç–µ `.env` –¥–ª—è Pi Camera:
   ```dotenv
   CAMERA_BACKEND=V4L2  # –ª—É—á—à–µ –¥–ª—è Pi Camera
   VIDEO_DEVICE=/dev/video0
   ```

3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç:
   ```bash
   # –ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–∞—é—Ç –æ—à–∏–±–∫–∏ —Å–µ—Ç–∏, —Å–Ω–∞—á–∞–ª–∞ –æ—á–∏—Å—Ç–∏—Ç–µ —Å—Ç–∞—Ä—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∏ —Å–µ—Ç–∏:
   docker compose -f docker-compose.yml -f docker-compose.pi.yml down
   docker network prune -f
   
   # –ó–∞—Ç–µ–º –∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç:
   docker compose -f docker-compose.yml -f docker-compose.pi.yml up -d --build
   ```

### –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–∏—Å—Ç–µ–º—ã

–î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ Raspberry Pi:

```bash
sudo ./scripts/install-systemd.sh
```

–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:
- `sudo systemctl start dc-detector` - –∑–∞–ø—É—Å–∫
- `sudo systemctl stop dc-detector` - –æ—Å—Ç–∞–Ω–æ–≤–∫–∞
- `sudo systemctl status dc-detector` - —Å—Ç–∞—Ç—É—Å
- `sudo journalctl -u dc-detector -f` - –ª–æ–≥–∏

### –í–∏–¥–µ–æ–ø–æ—Ç–æ–∫

- –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ `/` –∏–ª–∏ `/devtool.html` ‚Äî –ø–æ—Ç–æ–∫ —Å –≤–µ–±‚Äë–∫–∞–º–µ—Ä—ã –∫–ª–∏–µ–Ω—Ç–∞ (–∫–∞–∫ –≤ Windows)
- –î–ª—è —Ä–µ–∂–∏–º–∞ ¬´–ø–æ—Ç–æ–∫ —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞¬ª –Ω–∞ Raspberry Pi —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `LOCAL_CAMERA_ENABLED=0` –≤ `.env`
- –û—Ç–∫—Ä–æ–π—Ç–µ: `http://<IP-raspberry-pi>/devtool.html?async=true` ‚Äî –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –ø–æ—Ç–æ–∫ —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º FPS
- –î–æ—Å—Ç—É–ø –ø–æ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏: `http://<IP-raspberry-pi>/` –∏–ª–∏ `https://<IP-raspberry-pi>/`
- –§—Ä–æ–Ω—Ç–µ–Ω–¥ –æ–±—Å–ª—É–∂–∏–≤–∞–µ—Ç—Å—è nginx –Ω–∞ 80/443 (—Å–∞–º–æ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –≤ –æ–±—Ä–∞–∑–µ).
- –î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ –Ω–∞ IP –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS: https://<IP>/ –∏ –ø—Ä–∏–º–∏—Ç–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç. –ù–∞ `localhost` HTTPS –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω.

#### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è FPS –Ω–∞ Raspberry Pi

1. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∫–∞–º–µ—Ä—É –Ω–∞ —Ö–æ—Å—Ç–µ (V4L2):
   ```bash
   sudo modprobe bcm2835-v4l2
   v4l2-ctl -d /dev/video0 --set-fmt-video=width=640,height=480,pixelformat=MJPG
   v4l2-ctl -d /dev/video0 --set-parm=15
   ```

2. –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ `.env`:
   ```dotenv
  # –î–ª—è –ø–æ—Ç–æ–∫–∞ —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ (–∫–∞–º–µ—Ä–∞ –∫–ª–∏–µ–Ω—Ç–∞, –∫–∞–∫ –Ω–∞ Windows):
  LOCAL_CAMERA_ENABLED=0

  # –ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Pi Camera –Ω–∞–ø—Ä—è–º—É—é (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º):
  # VIDEO_DEVICE=/dev/video0
  # LOCAL_CAMERA_ENABLED=1
  # CAMERA_BACKEND=V4L2
  # CAMERA_INDEX=0
  # CAMERA_SCAN_LIMIT=1
  # CAPTURE_RETRY_DELAY=0.5
   STREAM_MAX_FPS=20   # FPS RAW MJPEG –ø–æ—Ç–æ–∫–∞
   INFER_FPS=5         # FPS –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–∞ YOLO
   INFER_IMGSZ=416     # —Ä–∞–∑–º–µ—Ä –≤—Ö–æ–¥–∞ –º–æ–¥–µ–ª–∏ (320/384/416)
   ```

3. API –ø–æ—Ç–æ–∫–æ–≤ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏/–æ—Ç–ª–∞–¥–∫–∏:
   - `GET /api/detections/stream` ‚Äî MJPEG —Å —Å–µ—Ä–≤–µ—Ä–Ω–æ–π —Ä–∞–∑–º–µ—Ç–∫–æ–π
   - `GET /api/detections/stream-raw` ‚Äî ¬´—á–∏—Å—Ç—ã–π¬ª MJPEG –±–µ–∑ —Ä–∞–∑–º–µ—Ç–∫–∏

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

–ó–∞–ø—É—Å—Ç–∏—Ç–µ –∞–≤—Ç–æ—Ç–µ—Å—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏:

```bash
./scripts/test-deployment.sh
```

–°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç –≤—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã, –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–∏—Å–æ–≤ –∏ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å Pi Camera.

–û—Å—Ç–∞–Ω–æ–≤–∫–∞:
```bash
docker compose down
```

## 4. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

- –õ–æ–≥–∏ —Å–µ—Ä–≤–∏—Å–æ–≤: `docker compose logs -f backend detection`
- –û—á–∏—Å—Ç–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–µ—Ç–µ–∫—Ü–∏–π: —É–¥–∞–ª–∏—Ç–µ —Ñ–∞–π–ª—ã –≤ `data/detections`
- –ü–æ–ª–Ω—ã–π —Å–±—Ä–æ—Å: `docker compose down -v`

## 5. –ß–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã

- **–ì–¥–µ —Ö—Ä–∞–Ω–∏—Ç—å –º–æ–¥–µ–ª–∏?** –í `services/detection/models/`; –∫–∞—Ç–∞–ª–æ–≥ –º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä.
- **–ì–¥–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è GIF?** –í `data/detections/saved/YYYY-MM-DD/`. –î–æ—Å—Ç—É–ø –∫ gif: `/files/detections/saved/YYYY-MM-DD/<id>.gif`.
- **–ö–∞–∫ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–ª–∏–ø?** –í–æ –≤–∫–ª–∞–¥–∫–µ ¬´–°–ø–∏—Å–æ–∫¬ª –Ω–∞–∂–º–∏—Ç–µ ¬´–°–æ—Ö—Ä–∞–Ω–∏—Ç—å¬ª —É –Ω—É–∂–Ω–æ–π –¥–µ—Ç–µ–∫—Ü–∏–∏ (–∫–∞–¥—Ä—ã –±–µ—Ä—É—Ç—Å—è –∏–∑ –±—É—Ñ–µ—Ä–∞).
- **–ì–¥–µ —É–≤–∏–¥–µ—Ç—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ?** –í–∫–ª–∞–¥–∫–∞ ¬´–°–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ¬ª –∏–ª–∏ `GET /api/detections/saved?date=YYYY-MM-DD`.


